# Technical Specification: Agent Task JSON Schema

Purpose
-------
This file defines the canonical JSON Schema for an Agent Task used by Project Chimera agents and orchestrators. The schema enforces a clear contract between task producers (planners, UIs) and consumers (agents, sidecars, execution engines). It explicitly includes `required_mcp_tools` and `budget_limit` to support Agentic Commerce and safe runtime enforcement.

JSON Schema
-----------
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Task",
  "type": "object",
  "required": ["id", "task_type", "inputs", "required_mcp_tools", "budget_limit"],
  "properties": {
    "id": {"type": "string", "pattern": "^[a-zA-Z0-9_\-:.]+$"},
    "title": {"type": "string"},
    "description": {"type": "string"},
    "task_type": {"type": "string"},
    "created_by": {"type": "string"},
    "created_at": {"type": "string", "format": "date-time"},
    "inputs": {"type": "object"},
    "outputs": {"type": "object"},
    "required_mcp_tools": {
      "type": "array",
      "minItems": 1,
      "items": {"type": "string"},
      "description": "List of MCP-exposed tool identifiers/names the agent must have access to before executing this task."
    },
    "budget_limit": {
      "type": "object",
      "description": "Monetary or resource budget ceiling for the task (Agentic Commerce).",
      "required": ["amount", "currency"],
      "properties": {
        "amount": {"type": "number", "minimum": 0},
        "currency": {"type": "string", "pattern": "^[A-Z]{3}$"},
        "scope": {"type": "string", "enum": ["task", "step", "session"], "default": "task"}
      },
      "additionalProperties": false
    },
    "priority": {"type": "integer", "minimum": 0, "maximum": 10},
    "ttl_seconds": {"type": "integer", "minimum": 0},
    "constraints": {"type": "object"},
    "metadata": {"type": "object"}
  },
  "additionalProperties": false
}
```

Example
-------
```json
{
  "id": "order-creation-20260206-001",
  "title": "Create purchase order for social ad credit",
  "description": "Buy $500 of ad credit and return the confirmation ID.",
  "task_type": "transactional",
  "created_by": "planner-service",
  "created_at": "2026-02-06T15:04:05Z",
  "inputs": {"account_id": "acct-123", "campaign": "spring-sale"},
  "required_mcp_tools": ["payments:initiate", "ads:purchaseCredit"],
  "budget_limit": {"amount": 500, "currency": "USD", "scope": "task"}
}
```

Why define schemas before writing Python code?
------------------------------------------------
- **Clear contract:** A schema creates an unambiguous contract between producers and consumers so runtime components know exactly what to expect.
- **Early validation:** Validating inputs at the boundary prevents malformed tasks from reaching agent runtime, reducing runtime errors.
- **Safety & governance:** Fields like `budget_limit` are enforcement points for cost-control and compliance (prevents runaway spending in Agentic Commerce).
- **Capability gating:** `required_mcp_tools` enumerates required capabilities; orchestrators can pre-check availability and access rights before execution.
- **Easier testing & mocking:** Schemas enable automated test-case generation, consistent mocks, and deterministic simulations.
- **Type generation & tooling:** Schemas allow automatic generation of type bindings, serializers, and validation code in Python (and other languages), accelerating development.
- **Security & auditability:** Schemas force explicit provenance and constraints, making it easier to audit and reason about agent behavior.

Next steps
----------
- Review this schema against specific agent workflows in the SRS and provide any required additional fields (e.g., explicit `approval_required`, `cost_center`, or `legal_justification`).
- After approval, I can generate a small Python validator module and unit tests that enforce this schema at runtime.

---
Generated by the architecting phase for Project Chimera.
